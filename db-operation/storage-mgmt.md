---
title: 存储管理
id: storage-mgmt
---

# 存储管理

## 存储路径设置

### 默认存储路径和系统要求

下表列出了 KWDB 各类文件的默认存储路径、文件系统和配置信息。

| <div style="width:80px">文件</div>       | 默认路径               | 大小               | 文件系统                                                   | 配置参数    |
| ---------- | ---------------------- | ------------------ | ---------------------------------------------------------- | ----------- |
| 数据文件   | `/var/lib/kaiwudb`       | 取决于存储数据的大小 | - 建议使用 ext4 文件系统。<br>- 如果存储大于 16 TB 的数据，建议使用 XFS 系统。 | - 部署配置文件中的 `data_root` 参数<br>- `--store` 启动参数     |
| 日志       | `/var/lib/kaiwudb/logs`  | 默认 1G，可配置    | 建议使用 ext4 文件系统。                                       | `--log-dir` 启动参数  |
| 证书       | `/etc/kaiwudb/certs`     | N/A                | 建议使用 ext4 文件系统。                                       | `--certs-dir` 启动参数 |
| 二进制文件 | `/usr/local/kaiwudb/bin` | > 200 M              | 建议使用 ext4 文件系统。                                       | N/A            |
| 动态库文件 | `/usr/local/kaiwudb/lib` | > 100 M              | 建议使用 ext4 文件系统。                                       | N/A            |

::: warning 说明
如果采用 Docker 容器部署，则使用宿主机路径，系统自动进行挂载。
:::

### 存储路径设置

KWDB 支持以下存储路径设置方式：

- 安装时通过修改 `deploy.cfg` 文件中的 `data_root` 参数自定义数据路径。
- 部署完成后，用户也可以通过修改部署生成的 `kaiwudb_env` 文件、 `docker-compose.yml` 文件或 `kwbase start` 命令修改存储路径。

## 时序数据重组

时序数据重组是指按照特定规则对原始数据进行清理和整理的过程，主要应用于以下场景：

- **删除数据清理**：执行 Delete 操作后，清理被标记删除的数据以释放存储空间
- **过期数据清理**：清理通过生命周期管理功能识别出的过期数据

数据重组可以优化存储空间利用率，提升数据库查询性能和响应速度，改善整体系统效率。

### 重组流程

数据重组以分区（Partition）为基本单位，系统采用单线程串行方式处理重组任务，确保操作的稳定性和数据一致性。

具体流程如下：

1. 任务触发：系统定期自动触发重组任务
2. 分区遍历：依次扫描各个分区，对每个分区执行重组操作
3. 数据清理：
   - 清理过期数据
   - 清理被标记删除的数据
4. 文件重建：生成优化后的新数据文件，替换原有文件
5. 标记清理：清理相关的删除标记记录，完成重组流程

重组操作与合并操作互斥，同一 entity segment 不会同时执行这两种操作。

### 重组配置

在 KWDB 中，数据重组功能默认启用，用户可以通过 `ts.auto_vacuum.enabled` 实时参数选择是否启用或禁用该功能。有关详细信息，参见[集群实时参数](./cluster-settings-config.md#实时参数)。